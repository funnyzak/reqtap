# ReqTap configuration file example
# Copy this file to config.yaml and modify configuration as needed

# HTTP server configuration
server:
  # Listen port (1-65535)
  port: 38888

  # URL path prefix to listen
  # "/" receives requests from all paths
  # "/webhook/" receives only requests starting with /webhook/
  # "/reqtap"  receives only requests starting with /reqtap
  path: "/reqtap/"

  # Maximum allowed body size per request in bytes (0 disables the limit)
  max_body_bytes: 10485760

  # Immediate response rules applied before forwarding
  responses:
    - name: "default-ok"
      status: 200
      body: "ok"
      headers:
        Content-Type: text/plain
    - name: "stripe-simulated"
      methods: ["POST"]
      path_prefix: "/stripe"
      status: 202
      body: '{"status":"queued"}'
      headers:
        Content-Type: application/json

# Logging configuration
log:
  # Log level: trace, debug, info, warn, error, fatal, panic
  level: "info"

  # File logging configuration
  file_logging:
    # Enable file logging
    enable: false

    # Log file path
    path: "./reqtap.log"

    # Maximum size of a single log file (MB)
    max_size_mb: 10

    # Maximum number of old log files to retain
    max_backups: 5

    # Maximum retention days for old log files
    max_age_days: 30

    # Compress old log files
    compress: true

# Request forwarding configuration
forward:
  # List of target URLs to forward to
  # Leave empty to disable forwarding and only log requests
  urls: []
  # urls:
  #   - "http://localhost:3000/webhook"
  #   - "https://api.example.com/ingest"
  #   - "http://webhook.site/your-unique-id"

  # Timeout for forwarding requests (seconds)
  timeout: 30

  # Response header timeout (seconds) for slow upstreams
  response_header_timeout: 15

  # TLS handshake timeout (seconds)
  tls_handshake_timeout: 10

  # Expect-Continue timeout (seconds)
  expect_continue_timeout: 1

  # Number of retries on failure
  max_retries: 3

  # Maximum concurrent forwarding requests
  max_concurrent: 10

  # Max idle connections (overall and per host)
  max_idle_conns: 200
  max_idle_conns_per_host: 50

  # Max connections per host
  max_conns_per_host: 100

  # Idle connection timeout (seconds)
  idle_conn_timeout: 90

  # Skip TLS verification (not recommended for production)
  tls_insecure_skip_verify: false

  # Path strategy controls how request paths are forwarded
  path_strategy:
    # Options: append, strip_prefix, rewrite
    mode: "strip_prefix"
    # Optional overriding prefix to remove; defaults to server.path when empty
    strip_prefix: "/reqtap"
    # Rewrite rules are evaluated in order when mode == rewrite
    # rules:
    #   - name: "drop-tenant"
    #     match: "/tenant"
    #     replace: "/api"
    #   - name: "regex-swap"
    #     match: "^/org/(.*)$"
    #     replace: "/$1"
    #     regex: true

  # Header filtering
  # Blacklist is applied first; whitelist (if non-empty) restricts forwarded headers to the listed names
  header_blacklist:
    - "host"
    - "connection"
    - "keep-alive"
    - "proxy-authenticate"
    - "proxy-authorization"
    - "te"
    - "trailers"
    - "transfer-encoding"
    - "upgrade"
    - "content-length"
  header_whitelist: []

# Web console configuration
web:
  # Enable web UI and APIs
  enable: true

  # Base path for static assets (UI)
  path: "/web"

  # Administrative API base path
  admin_path: "/api"

  # Maximum number of in-memory requests retained
  max_requests: 500

  auth:
    # Enable authentication
    enable: true
    # Session expiration duration
    session_timeout: 24h
    # User list (replace default credentials in production)
    users:
      - username: "admin"
        password: "admin123"
        role: "admin"
      - username: "user"
        password: "user123"
        role: "viewer"

  export:
    # Enable data export APIs
    enable: true
    # Allowed export formats
    formats: ["json", "csv", "txt"]

# CLI / output configuration
output:
  # console or json
  mode: "console"
  # When true, disables banner and request printing (logs still emit)
  silence: false
